<html lang="ar" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
    <title>Sanaway Bible</title>
    <link rel="stylesheet" type="text/css" href="http://localhost:8080/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <link rel="icon" href="/Picture1.png" type="image/png" />

    <link href="http://localhost:8080/assets/css/bootstrap.css" rel="stylesheet" />

    <link href="http://localhost:8080/assets/css/font-awesome.css" rel="stylesheet" />

    <link href="http://localhost:8080/assets/css/custom.css" rel="stylesheet" />

    <link href='http://localhost:8080/http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'
        type='text/css' />
<style>
/* ID Card Styles */
#idCard {
  background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
  border-radius: 32px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.15), 0 8px 32px rgba(0,0,0,0.1);
  width: 480px;
  height: 320px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-around;
  padding: 24px;
  box-sizing: border-box;
  border: 1px solid rgba(255,255,255,0.2);
  position: relative;
  overflow: hidden;
  margin: auto;
}

#idCard::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #667eea, #764ba2);
}

#idCard .student-name {
  font-size: 2rem;
  font-weight: 800;
  color: #1a1a1a;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

#idCard .barcode {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 400px;
  height: 100px;
  background: rgba(255,255,255,0.8);
  border-radius: 16px;
  padding: 8px;
  box-shadow: inset 0 2px 8px rgba(0,0,0,0.1);
}

#idCard .barcode canvas {
  max-width: 100%;
  height: auto;
}

#idCard .barcode-number {
  font-size: 2rem;
  font-weight: 900;
  color: #1a1a1a;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
</style>


</head>

<body>
    <div id="wrapper">
        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="adjust-nav">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#"><i class="fa fa-square-o "></i>&nbsp;Sanawy Bible</a>
                </div>


            </div>
        </div>
        <!-- /. NAV TOP  -->
        <nav class="navbar-default navbar-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav" id="main-menu">
                    <li class="text-center user-image-back">
                        <img src="assets/img/find_user.png" class="img-responsive" />
                        <h3 style="color: antiquewhite;">
                            <%= user_data.user %>
                        </h3>

                    </li>

 <li>
                    <a href="/attendance"><i class="fa fa-desktop "></i>attendance</a>
                </li>
              

                <li>
                    <a href="/add_student"><i class="fa fa-table "></i> Add Student</a>
                </li>
                <li>
                    <a href="/ranking"><i class="fa fa-edit "></i>Ranking </a>
                </li>


              
                <li>
                    <a href="/all_student"><i class="fa fa-qrcode "></i>All Student</a>
                </li>
                <li>
                    <a href="/add_student_points"><i class="fa fa-bar-chart-o"></i>Add Points</a>
                </li>
                    
                </ul>

            </div>

        </nav>
        <!-- /. NAV SIDE  -->
        <div id="page-wrapper">
            <div id="page-inner">
                <div class="row">
                    <div class="col-md-12">
                        <h2>Admin Dashboard</h2>
                    </div>
                </div>
                <!-- /. ROW  -->
               
<div class="col-md-6">
    <h5>Student</h5>
    <div class="table-responsive">
        <table class="table table-auto w-auto">
            <thead>
                <tr>
                    <th>#</th>
                    <th style="white-space: nowrap;">Student Name</th>
                    <th style="white-space: nowrap;">Student Number</th>
                    <th style="white-space: nowrap;">Student Mail</th>
                    <th style="white-space: nowrap;">Student Level</th>
                    <th style="white-space: nowrap;">Student ID</th>
                </tr>
            </thead>
            <tbody>
                <% for (let i = 0; i < student_data.length; i++) { 
                    let rowClass = "info"; // Default class

                    if (student_data[i].student_level === "1s") {
                        rowClass = "success";
                    } else if (student_data[i].student_level === "2s") {
                        rowClass = "warning";
                    } else if (student_data[i].student_level === "3s") {
                        rowClass = "danger";
                    }
                %>
                    <tr class="<%= rowClass %>">
                        <td><%= i + 1 %></td>
                        <td style="white-space: nowrap;"><%= student_data[i].student_name %></td>
                        <td style="white-space: nowrap;"><%= student_data[i].student_number %></td>
                        <td style="white-space: nowrap;"><%= student_data[i].student_mail %></td>
                        <td style="white-space: nowrap;"><%= student_data[i].student_level %></td>
                        <td style="white-space: nowrap;">
  <button class="btn btn-primary generate-id"
          data-name="<%= student_data[i].student_name %>"
          data-number="<%= student_data[i].student_number %>"
          data-email="<%= student_data[i].student_mail %>">
    Generate & Send ID
  </button>
</td>


                    </tr>
                <% } %>
            </tbody>
        </table>
    </div>
</div>

                </div>
              
<div id="idCardContainer" style="display:none">
  <div class="id-card" id="idCard">
    <div class="student-name" id="studentName"></div>
    <div class="barcode">
      <canvas id="barcode"></canvas>
    </div>
    <div class="barcode-number" id="studentNumber"></div>
  </div>
</div>
<script src="http://localhost:8080/assets/js/jquery-1.10.2.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

<script>
$(document).ready(function () {
  $('.generate-id').click(function () {
    const name = $(this).data('name');
    const number = $(this).data('number');
    const email = $(this).data('email');

    $('#studentName').text(name);
    $('#studentNumber').text(number);

    JsBarcode("#barcode", number, {
      format: "CODE128",
      width: 3,
      height: 60,
      displayValue: false,
      background: "#ffffff",
      lineColor: "#000000",
      margin: 10
    });

    setTimeout(() => {
      $('#idCardContainer').css('display', 'block'); // show card
      html2canvas(document.getElementById('idCard'), {
        backgroundColor: null,
        scale: 2,
        useCORS: true,
        allowTaint: true
      }).then(canvas => {
        $('#idCardContainer').css('display', 'none'); // hide again
        canvas.toBlob(function(blob) {
          const formData = new FormData();
          formData.append('name', name);
          formData.append('number', number);
          formData.append('email', email);
          formData.append('idcard', blob, `${name}_id_card.png`);

          fetch("/all_student", {
            method: 'POST',
            body: formData
          })
          .then(response => response.text())
          .then(result => {
            alert(result);
          })
          .catch(err => {
            console.error(err);
            alert('Error sending ID card');
          });
        }, 'image/png');
      });
    }, 500);
  });
});
</script>



            </div>
            <!-- /. PAGE INNER  -->
        </div>
        <!-- /. PAGE WRAPPER  -->
    </div>
    <!-- /. WRAPPER  -->
    <!-- SCRIPTS -AT THE BOTOM TO REDUCE THE LOAD TIME-->
    <!-- JQUERY SCRIPTS -->
    <script src="http://localhost:8080/assets/js/jquery-1.10.2.js"></script>
    <!-- BOOTSTRAP SCRIPTS -->
    <script src="http://localhost:8080/assets/js/bootstrap.min.js"></script>
    <!-- METISMENU SCRIPTS -->
    <script src="http://localhost:8080/assets/js/jquery.metisMenu.js"></script>
    <!-- CUSTOM SCRIPTS -->
    <script src="http://localhost:8080/assets/js/custom.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

</body>

</html>